
--TABLA DE SPELLS

setDefaultTab("spells")
local name = UI.Label("KNIGHT")

macro(800, function()
  local rainbowDelay = 0
  for k, color in ipairs({"#00bfff", "#0099cc", "#0077b3", "#005c99", "#004080", "#002966"}) do
    schedule(rainbowDelay, function()
      name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called

local pvp = true
local Spells = {
    {name = "", cast = true, amount = 1, distance = 1, safe = true, turning = false, buffSpell = true, manaCost = 290},
    {name = "exori hur", cast = false, amount = 1, distance = 5, safe = true, turning = false, buffSpell = false, manaCost = 300},
    {name = "exori", cast = true, amount = 2, distance = 1, safe = false, turning = false, buffSpell = false, manaCost = 200},
    {name = "exori gran", cast = true, amount = 2, distance = 1, safe = false, turning = true, buffSpell = false, manaCost = 200},
    {name = "exori", cast = true, amount = 2, distance = 1, safe = false, turning = false, buffSpell = false, manaCost = 200},
    {name = "exori", cast = true, amount = 2, distance = 1, safe = true, turning = false, buffSpell = false, manaCost = 200},
    {name = "exori ico", cast = true, amount = 1, distance = 5, safe = true, turning = false, buffSpell = false, manaCost = 40},
}

macro(500, "Rotacion Spell EK" , function()
    local isSafe = true;
    local target = g_game.getAttackingCreature()
    local direct

if not g_game.isAttacking() then
    return
end

if player:getPosition().z == target:getPosition().z then
    if  player:getPosition().x > target:getPosition().x then direct = 3 -- west
    elseif  player:getPosition().x < target:getPosition().x then direct = 1 -- east
    elseif player:getPosition().y < target:getPosition().y then direct = 0 -- north
    elseif  player:getPosition().y > target:getPosition().y then direct = 2 -- south
end

for _, spell in ipairs(Spells) do
    local specAmount = 0
    for i,mob in ipairs(getSpectators()) do
        if (getDistanceBetween(player:getPosition(), mob:getPosition())  <= spell.distance and mob:isMonster())  then
            specAmount = specAmount + 1
    end
        if (mob:isPlayer() and player:getName() ~= mob:getName()) then
            isSafe = false;
        end
end
    if (spell.cast) and (specAmount >= spell.amount) and (mana() >= spell.manaCost) then
        if turning then
            turn(direct)
        end
        if not spell.buffSpell or not hasPartyBuff() then
            if pvp then
                if isSafe then   
                    say(spell.name) 
             elseif not isSafe and spell.safe then
                    say(spell.name)         
                end
            else
                say(spell.name)
            end
        end
    end
end
end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(12010, "Utito Tempo", function()
  if g_game.isAttacking() then
    say("utito tempo")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2510, "Exeta Amp Res", function()
  if g_game.isAttacking() then
    say("exeta amp res")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(6010, "Exeta Res", function()
  if g_game.isAttacking() then
    say("exeta res")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(6010, "Exori Ico", function()
  if g_game.isAttacking() then
    say("exori ico")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(6010, "Exori Hur", function()
  if g_game.isAttacking() then
    say("exori hur")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(4010, "Exori Gran Ico", function()
  if g_game.isAttacking() then
    say("exori gran ico")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(4010, "Exori Min", function()
  if g_game.isAttacking() then
    say("exori min")
  end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
local distance = 2
macro(4010, "Exori (No-Pk)",  function() -- editar nome da spell
    local playerInScreen = false
    if not g_game.isAttacking() then
        return
    end
    for i,mob in ipairs(getSpectators()) do
        if (getDistanceBetween(player:getPosition(), mob:getPosition())  <= distance and mob:isPlayer())  and (player:getName() ~= mob:getName()) then
            playerInScreen = true
        end
    end

    if not playerInScreen then 
      say("exori") --nadaxD
    end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(4010, "Exori", function()
  if g_game.isAttacking() then
    say("exori")
  end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
local distance = 5
macro(6010, "Exori Gran (No-Pk)",  function() -- editar nome da spell
    local playerInScreen = false
    if not g_game.isAttacking() then
        return
    end
    for i,mob in ipairs(getSpectators()) do
        if (getDistanceBetween(player:getPosition(), mob:getPosition())  <= distance and mob:isPlayer())  and (player:getName() ~= mob:getName()) then
            playerInScreen = true
        end
    end

    if not playerInScreen then 
      say("exori gran") --nadaxD
    end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(6010, "Exori Gran", function()
  if g_game.isAttacking() then
    say("exori gran")
  end
end, SpellsTab)
local SpellTab = addTab("Spells")


local SpellTab = addTab("Spells")
local name = UI.Label("PALADIN")

macro(800, function()
  local rainbowDelay = 0
  for k, color in ipairs({"#ffff00", "#ffea00", "#ffd400", "#ffbf00", "#ffa900", "#ff9400"}) do
    schedule(rainbowDelay, function()
      name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end)


local SpellsTab = addTab("Spells") -- Add new tab called

local pvp = true
local Spells = {
    {name = "", cast = true, amount = 1, distance = 1, safe = true, turning = false, buffSpell = true, manaCost = 290},
    {name = "exori con", cast = false, amount = 1, distance = 5, safe = true, turning = false, buffSpell = false, manaCost = 300},
    {name = "exevo mas san ", cast = true, amount = 2, distance = 1, safe = false, turning = false, buffSpell = false, manaCost = 200},
    {name = "", cast = true, amount = 2, distance = 1, safe = false, turning = true, buffSpell = false, manaCost = 200},
    {name = "exevo mas san", cast = true, amount = 2, distance = 1, safe = false, turning = false, buffSpell = false, manaCost = 200},
    {name = "exevo mas san", cast = true, amount = 2, distance = 1, safe = true, turning = false, buffSpell = false, manaCost = 200},
    {name = "exori gran con", cast = true, amount = 1, distance = 5, safe = true, turning = false, buffSpell = false, manaCost = 40},
}

macro(500, "Rotacion Spell RP", function()
    local isSafe = true;
    local target = g_game.getAttackingCreature()
    local direct

if not g_game.isAttacking() then
    return
end

if player:getPosition().z == target:getPosition().z then
    if  player:getPosition().x > target:getPosition().x then direct = 3 -- west
    elseif  player:getPosition().x < target:getPosition().x then direct = 1 -- east
    elseif player:getPosition().y < target:getPosition().y then direct = 0 -- north
    elseif  player:getPosition().y > target:getPosition().y then direct = 2 -- south
end

for _, spell in ipairs(Spells) do
    local specAmount = 0
    for i,mob in ipairs(getSpectators()) do
        if (getDistanceBetween(player:getPosition(), mob:getPosition())  <= spell.distance and mob:isMonster())  then
            specAmount = specAmount + 1
    end
        if (mob:isPlayer() and player:getName() ~= mob:getName()) then
            isSafe = false;
        end
end
    if (spell.cast) and (specAmount >= spell.amount) and (mana() >= spell.manaCost) then
        if turning then
            turn(direct)
        end
        if not spell.buffSpell or not hasPartyBuff() then
            if pvp then
                if isSafe then   
                    say(spell.name) 
             elseif not isSafe and spell.safe then
                    say(spell.name)         
                end
            else
                say(spell.name)
            end
        end
    end
end
end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(10000, "Exana Amp Res", function()
  if g_game.isAttacking() then
    say("exana amp res")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(10000, "Utevo Grav San (Wheel)", function()
  if g_game.isAttacking() then
    say("utevo grav san")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
local distance = 5
macro(1500, "Exevo Mas San (No-Pk)",  function() -- editar nome da spell
    local playerInScreen = false
    if not g_game.isAttacking() then
        return
    end
    for i,mob in ipairs(getSpectators()) do
        if (getDistanceBetween(player:getPosition(), mob:getPosition())  <= distance and mob:isPlayer())  and (player:getName() ~= mob:getName()) then
            playerInScreen = true
        end
    end

    if not playerInScreen then 
      say("exevo mas san") --nadaxD
    end
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(2000, "Exevo Mas San", function()
  if g_game.isAttacking() then
    say("exevo mas san")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1900, "Exori Gran Con", function()
    if g_game.isAttacking() then
        say("exori gran con")
        say("exori gran con")
        say("exori gran con")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1900, "Exori Con", function()
    if g_game.isAttacking() then
        say("exori con")
        say("exori con")
        say("exori con")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1700, "Exori San", function()
    if g_game.isAttacking() then
        say("exori san")
        say("exori san")
        say("exori san")
    end
end, SpellsTab)


local SpellTab = addTab("Spells")
local name = UI.Label("SORCERER")

macro(800, function()
  local rainbowDelay = 0
  for k, color in ipairs({"#9b30ff", "#8629cc", "#712399", "#5c1d66", "#471833", "#330e00"}) do
    schedule(rainbowDelay, function()
      name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(5000, "Exevo Gran Mas Flam",function()
    if g_game.isAttacking() then
        say("exevo gran mas flam")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(3500, "Exevo Gran Mas vis", function()
    if g_game.isAttacking() then
        say("exevo gran mas vis")
        say("exevo gran mas vis")
        say("exevo gran mas vis")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(4000, "Exori Moe", function()
  if g_game.isAttacking() then
    say("exori Moe")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2000, "Exevo gran flam hur", function()
  if g_game.isAttacking() then
    say("exevo gran flam hur")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2000, "Exevo Vis Hur", function()
  if g_game.isAttacking() then
    say("exevo vis hur")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1000, "Exori Flam", function()
  if g_game.isAttacking() then
    say("exori flam")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1000, "Exori Vis", function()
  if g_game.isAttacking() then
    say("exori vis")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1000, "Exori Mort", function()
  if g_game.isAttacking() then
    say("exori mort")
  end
end, SpellsTab)


local SpellTab = addTab("Spells")
local name = UI.Label("DRUID")

macro(800, function()
  local rainbowDelay = 0
  for k, color in ipairs({"#00ff00", "#00e600", "#00cc00", "#00b300", "#009900", "#008000"}) do
    schedule(rainbowDelay, function()
      name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(100, "Exura Sio", function()
    local friend = getPlayerByName(storage.friendName)
    local friend1 = getPlayerByName(storage.friend1Name)
    if friend and friend:getHealthPercent() < 90 then
        say("exura sio \""..storage.friendName)
        delay(500)
   elseif friend1 and friend1:getHealthPercent() <= 91 then -- If u need more you can copy this lines
        say("exura sio \""..storage.friend1Name) --
        delay(500) --
    end -- And paste them between this end and the delay
end, SpellsTab)
  addTextEdit("friendName", storage.friendName or "Friend Name", function(widget, text) 
    storage.friendName = text
end, SpellsTab)
  addTextEdit("friend1Name", storage.friend1Name or "Friend Name", function(widget, text)   -- Also copy this lines
    storage.friend1Name = text -- If u add more just rename the Friend1Name to Friend2Name in the lines u paste
end, SpellsTab)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(4000, "Exevo Gran Mas Frigo",function()
    if g_game.isAttacking() then
        say("exevo gran mas frigo")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2500, "Exevo Gran Mas Tera", function()
    if g_game.isAttacking() then
        say("exevo gran mas tera")
        say("exevo gran mas tera")
        say("exevo gran mas tera")
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2000, "Exevo Frigo Hur", function()
  if g_game.isAttacking() then
    say("exevo frigo hur")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(2000, "Exevo Tera Hur", function()
  if g_game.isAttacking() then
    say("exevo tera hur")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1000, "Exori Frigo", function()
  if g_game.isAttacking() then
    say("exori frigo")
  end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(1000, "Exori Tera", function()
  if g_game.isAttacking() then
    say("exori tera")
  end
end, SpellsTab)


--TABLA DE RUNAS

local SpellTab = addTab("Spells")
local name = UI.Label("RUNAS")

macro(800, function()
  local rainbowDelay = 0
  for k, color in ipairs({"#ffffff", "#f2f2f2", "#e6e6e6", "#d9d9d9", "#cccccc", "#bfbfbf"}) do
    schedule(rainbowDelay, function()
      name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end)


local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Sd ", function()
    if g_game.isAttacking() then
        usewith(3155, g_game.getAttackingCreature())
        delay(1200)
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Avalanche", function()
    if g_game.isAttacking() then
        usewith(3161, g_game.getAttackingCreature())
        delay(1200)
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Great Fireball ", function()
    if g_game.isAttacking() then
        usewith(3191, g_game.getAttackingCreature())
        delay(1200)
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Stone Shower", function()
    if g_game.isAttacking() then
        usewith(3175, g_game.getAttackingCreature())
        delay(1200)
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Thunderstorm", function()
    if g_game.isAttacking() then
        usewith(3202, g_game.getAttackingCreature())
        delay(1200)
    end
end, SpellsTab)

local SpellsTab = addTab("Spells") -- Add new tab called
macro(400, "Runa Paralize", function()
    if g_game.isAttacking() then
        usewith(3165, g_game.getAttackingCreature())
        delay(10000)
    end
end, SpellsTab)


--TABLA DE TOOLS


setDefaultTab("Tools")
local panelName = "Dummy Train"
local ui = setupUI([[
Panel
  height: 30

  BotItem
    id: item
    anchors.top: parent.top
    anchors.left: parent.left
    margin-top: 2

  BotSwitch
    id: title
    anchors.top: parent.top
    anchors.left: item.right
    anchors.bottom: item.verticalCenter
    text-align: center
    !text: tr('Dummy Train')
    margin-left: 2
    width: 110

  BotItem
    id: Target
    anchors.top: parent.top
    anchors.right: parent.right
    margin-left: 2
]], parent)
ui:setId(panelName)

if not storage[panelName] then
  storage[panelName] = {
      id = 28557,
      id2 = 28559,
      title = enabled,
      enabled = false,
  }
end

ui.title:setOn(storage[panelName].enabled)
ui.title.onClick = function(widget)
  storage[panelName].enabled = not storage[panelName].enabled
  widget:setOn(storage[panelName].enabled)
end

ui.item:setItemId(storage[panelName].id)
ui.item.onItemChange = function(widget)
  storage[panelName].id = widget:getItemId()
end

ui.Target:setItemId(storage[panelName].id2)
ui.Target.onItemChange = function(widget)
  storage[panelName].id2 = widget:getItemId()
end

function setDummyOff()
  storage[panelName].enabled = false
  ui.title:setOn(false)
end

function setDummyOn()
  storage[panelName].enabled = true
  ui.title:setOn(true)
end

addIcon("dummyTrainIcon", { item = 28559, text = "Dummy Train" }, function(icon, isOn)
  if isOn then
    setDummyOn()
  else
    setDummyOff()
  end
end)

macro(60 * 1000, function()
  if not storage[panelName].enabled then
    return
  end
  for __, tile in ipairs(g_map.getTiles(posz())) do
    if storage[panelName].id2 == tile:getTopUseThing():getId() and getDistanceBetween(pos(), tile:getPosition()) <= 7 then
      useWith(storage[panelName].id, tile:getTopUseThing())
    end
  end
end)


setDefaultTab("Tools")
macro(1000,"Auto Aceptar Party",function() 
  if player:getShield() > 2 then return end -- already in a party
  for s, spec in pairs(getSpectators(false)) do
    if spec:getShield() == 1 then
      g_game.partyJoin(spec:getId())
      delay(1000)
    end
  end
end)


setDefaultTab("Tools")

local palavraChave = 'medio metro gay' -- palavra que quer invitar aqui
local autoParty = macro(10000, "Auto Dar Party", function() end)
onTalk(function(name, level, mode, text, channelId, pos)
    if autoParty:isOff() then return end
    if player:getShield() == 4 then 
        g_game.partyShareExperience(not player:isPartySharedExperienceActive())
    end
    if name == player:getName() then return end
    if mode ~= 1 then  return end
    if string.find(text, palavraChave) then
        local friend = getPlayerByName(name)
        g_game.partyInvite(friend:getId())
    end
end)


-- START CONFIG
setDefaultTab("Tools")
local macroName = "Boss Alerta"
-- Define the array of alert messages
local alertMessages = {
    "warning! the murder of",
    "danger! beware of",
    "attention! deadly attack from",
    "The following items are available in your reward chest:",
    "The dragons of the Dragonblaze Mountains have descended to Zao to protect the lizardkin!",
    -- Add more alert messages if needed
}
-- END CONFIG

local m = macro(132123131, macroName, function() end)

onTextMessage(function(mode, text)
  if not m.isOn() then return end
  for _, alertMessage in ipairs(alertMessages) do
    if text:lower():find(alertMessage:lower()) then
      playAlarm()
      g_window.flash()
      break
    end
  end
end) 


setDefaultTab("Tools")
local colorTable = {
  ['Dragon'] = {'#008C9A', '#00707B', '#00545C', '#00383E', '#000E0F', '#000000'},
  ['Dragon Lord'] = {'#F59E03', '#C47E02', '#935F02', '#623F01', '#191000', '#000000'},
  ['Default'] = {'#00FF00', '#7CFC00', '#32CD32', '#008000', '#006400', '#000000'},
}

function doChangeColor(creature, healthPercent)
  if creature:isMonster() then
    local name = creature:getName()
    local color = colorTable[name]
    if not color then
      color = colorTable['Default']
    end
    if color then
      if healthPercent >= 95 then
        creature:setInformationColor(color[1])
      elseif healthPercent > 60 then
        creature:setInformationColor(color[2])
      elseif healthPercent > 30 then
        creature:setInformationColor(color[3])
      elseif healthPercent > 10 then
        creature:setInformationColor(color[4])
      elseif healthPercent > 3 then
        creature:setInformationColor(color[5])
      elseif healthPercent >= 0 then
        creature:setInformationColor(color[6])
      end
    end
  end
end

local monstercolor = macro(20000, "Nombres De Color", function() end)
onCreatureAppear(function(creature)
  if monstercolor:isOff() then return end
    doChangeColor(creature, creature:getHealthPercent())
end)

onCreatureHealthPercentChange(function(creature, healthPercent)
  doChangeColor(creature, healthPercent)
end)


setDefaultTab("Tools")
macro(5000, "Auto Mount", function() 
	if isInPz() then return end
	if not player:isMounted() then player:mount() end
 end)


--[[Esconder Magias Laranjas da tela]]--
TH = macro(100, "Sin Letras Naranjas", function() end)
onStaticText(function(thing, text)
    if TH.isOff() then return end
    if not text:find('says:') then
        g_map.cleanTexts()
    end
end)

--[[esconder MAGIAS(SPRITES)]]--
sprh = macro(100, "Esconder Sprite", function() end)
onAddThing(function(tile, thing)
    if sprh.isOff() then return end
    if thing:isEffect() then
        thing:hide()
    end
end)

local showhp = macro(5000, "Monster HP %", function() end)
onCreatureHealthPercentChange(function(creature, healthPercent)
    if showhp:isOff() then  return end
    if creature:isMonster() or creature:isPlayer() and creature:getPosition() and pos() then
        if getDistanceBetween(pos(), creature:getPosition()) <= 5 then
            creature:setText(healthPercent .. "%")
        else
            creature:clearText()
        end
    end
end)



setDefaultTab("Tools")
local urToolId = 5942 -- your tool id here 
local knifeBodies = {4097, 4137, 8738, 18958}

macro(500, "BWS Cuerpos", function()
  for i, tile in ipairs(g_map.getTiles(posz())) do
    local item = tile:getTopThing()
    if item and item:isContainer() then
      if math.max(math.abs(posx()-tile:getPosition().x), math.abs(posy()-tile:getPosition().y)) <= 5 then
        if table.find(knifeBodies, item:getId()) and findItem(urToolId) then
          useWith(urToolId, item)
          CaveBot.delay(500)
          return
        end
      end
    end
  end
end)


setDefaultTab("Tools")
local urToolId = 5908
local knifeBodies = {4286, 4272, 4173, 4011, 4025, 4047, 4052, 4057, 4062, 4112, 4212, 4321, 4324, 4327, 10352, 10356, 10360, 10364} 

macro(500, "Obsidian Knife Cuerpos", function()
  for i, tile in ipairs(g_map.getTiles(posz())) do
    local item = tile:getTopThing()
    if item and item:isContainer() then
      if math.max(math.abs(posx()-tile:getPosition().x), math.abs(posy()-tile:getPosition().y)) <= 5 then
        if table.find(knifeBodies, item:getId()) and findItem(urToolId) then
          useWith(urToolId, item)
          CaveBot.delay(500)
          return
        end
      end
    end
  end
end)


setDefaultTab("Tools")
local urToolId = 3483 -- your tool id here 
local knifeBodies = {9582}

macro(500, "Pescar Cuerpos", function()
  for i, tile in ipairs(g_map.getTiles(posz())) do
    local item = tile:getTopThing()
    if item and item:isContainer() then
      if math.max(math.abs(posx()-tile:getPosition().x), math.abs(posy()-tile:getPosition().y)) <= 5 then
        if table.find(knifeBodies, item:getId()) and findItem(urToolId) then
          useWith(urToolId, item)
          CaveBot.delay(500)
          return
        end
      end
    end
  end
end)


waterIds = {4597,4598,4599,4600,4601,4602}
minDistance = 7
macro(300, "Auto Pescar", function()
    local waterTiles = {}
  for _, tile in ipairs(g_map.getTiles(posz())) do
    if table.contains(waterIds, tile:getTopUseThing():getId()) and getDistanceBetween(pos(), tile:getPosition()) <= minDistance then
      table.insert(waterTiles, tile)
    end
  end
  if #waterTiles > 0 then
    useWith(3483, waterTiles[math.random(#waterTiles )]:getTopUseThing())
  end
end)


setDefaultTab("Tools") -- "Auto Dance"

macro(500, "Slow Dance", function()
    turn(math.random(0, 3))
    end)

macro(100, "Fast Dance", function()
    turn(math.random(0, 3))
    end)

macro(100, "Hyper Dance", function()
    turn(math.random(0, 3))
    end)


setDefaultTab("tools")
local txtImbuis = UI.Label()
txtImbuis:setColor("white")
txtImbuis:setText("------TOOLS MC------")


setDefaultTab("Tools")

followName = "autofollow"
if not storage[followName] then storage[followName] = { player = 'name'} end
local toFollowPos = {}

followTE = UI.TextEdit(storage[followName].player or "Mad Genius", function(widget, newText)
    storage[followName].player = newText
end)

local followMacro = macro(100, "Seguir", function()
    local target = getCreatureByName(storage[followName].player)
    if target then
        local tpos = target:getPosition()
        toFollowPos[tpos.z] = tpos
    end
    if player:isWalking() then
        return
    end
    local p = toFollowPos[posz()]
    if not p then
        return
    end
    if autoWalk(p, 20, { ignoreNonPathable = true, precision = 1 }) then
        delay(100)
    end
end)

onPlayerPositionChange(function(newPos, oldPos)
  if (g_game.isFollowing()) then
    tfollow = g_game.getFollowingCreature()

    if tfollow then
      if tfollow:getName() ~= storage[followName].player then
        followTE:setText(tfollow:getName())
        storage[followName].player = tfollow:getName()
      end
    end
  end
end)

onCreaturePositionChange(function(creature, newPos, oldPos)
    if creature:getName() == storage[followName].player and newPos then
        toFollowPos[newPos.z] = newPos
    end
end)


setDefaultTab("Tools")
if not storage.doorIds then
    storage.doorIds = { 5102, 5111, 11246, 11714, 5007, 8265, 1629, 6252, 6249, 7715, 7712, 7714, 6256, 1669, 1672, 5125, 5115, 5124, 17701, 17710, 1642, 6260, 5107, 4912, 6251, 5291, 1683, 1696, 1692, 5006, 2179, 30772, 30774, 6248, 5735, 5732, 23873, 5736, 6264, 5122, 30049, 30042, 7727 }
end

local moveTime = 2000     -- Wait time between Move, 2000 milliseconds = 2 seconds
local moveDist = 2        -- How far to Walk
local useTime = 2000     -- Wait time between Use, 2000 milliseconds = 2 seconds
local useDistance = 2     -- How far to Use

local function properTable(t)
    local r = {}
    for _, entry in pairs(t) do
        table.insert(r, entry.id)
    end
    return r
end


UI.Label("IDs Puertas")
UI.Separator()

local doorContainer = UI.Container(function(widget, items)
    storage.doorIds = items
    doorId = properTable(storage.doorIds)
end, true)

doorContainer:setHeight(35)
doorContainer:setItems(storage.doorIds)
doorId = properTable(storage.doorIds)

clickDoor = macro(1000, "Usar Puertas", function()
    for i, tile in ipairs(g_map.getTiles(posz())) do
        local item = tile:getTopUseThing()
        if item and table.find(doorId, item:getId()) then
            local tPos = tile:getPosition()
            local distance = getDistanceBetween(pos(), tPos)
            if (distance <= useDistance) then
                use(item)
                return delay(useTime)
            end

            if (distance <= moveDist and distance > useDistance) then
                if findPath(pos(), tPos, moveDist, { ignoreNonPathable = true, precision = 1 }) then
                    autoWalk(tPos, moveTime, { ignoreNonPathable = true, precision = 1 })
                    return delay(waitTime)
                end
            end
        end
    end
end)


--TABLA DE MAIN

local MainTab = addTab("Main")

local whatsappButton = UI.Button(">>CONTACTO WHATSAPP<<", function() g_platform.openUrl("https://chat.whatsapp.com/INwsCjK81U2JulKBO8HFXy") end)
MainTab:addChild(whatsappButton)


setDefaultTab("Main")

local name = UI.Label("((( MAD GENIUS )))")

macro(800,function()
  local rainbowDelay = 0
  for k,color in ipairs({"#FF0000", "#FFA500", "#FFFF00", "#008000", "#0000FF", "#4B0082", "#EE82EE", "#00FFFF", "#FF00FF", "#ADFF2F"} ) do
    schedule(rainbowDelay, function()
        name:setColor(color)
    end)
    rainbowDelay = rainbowDelay + 100 -- tempo entre elas
  end
end)


setDefaultTab("Main")
macro(200, "Ataque General", function()
-- Monstros que devem ser ignorados, evitando dar target.
    local ignoredMonsters = {
        ['paladin familiar'] = true,
        ['knight familiar'] = true, 
        ['sorcerer familiar'] = true,
        ['druid familiar'] = true,
        ['dog'] = true, ['blade'] = true,
        ['constantine'] = true,
} local spectators = g_map.getSpectators(g_game.getLocalPlayer():getPosition(), false)
for k,v in pairs(spectators) do
        if not g_game.isAttacking() and not isInPz() and v:isMonster()
        and getDistanceBetween(pos(), v:getPosition()) <= 5 -- distancia target
        and not ignoredMonsters[v:getName():lower()]
        then g_game.attack(v)
end
    end
        end) 


setDefaultTab("Main")
macro(10, "Seguir target", function()
  if g_game.isAttacking() then
    return autoWalk(g_game.getAttackingCreature():getPosition(), 10, {ignoreNonPathable=true, precision=1})
  end
end)


setDefaultTab("Main")
macro(100, "Mantener Target", function()
  if g_game.isAttacking() then
    oldTarget = g_game.getAttackingCreature()
  end
  if oldTarget and oldTarget:getPosition() then
    if not g_game.isAttacking() and getDistanceBetween(pos(), oldTarget:getPosition()) <= 8 then
      if oldTarget:getPosition().z == posz() then
        g_game.attack(oldTarget)
      end
    end
  end
end)


setDefaultTab("main")
local afkMsg = false
addSwitch("afkMsg", "Responder AFK", function(widget)
    afkMsg = not afkMsg
    widget:setOn(afkMsg)
end)

onTalk(function(name, level, mode, text, channelId, pos) --quando receber uma pm vai responder com a mensagem escolhida abaixo
    if mode == 4 and afkMsg == true then
        g_game.talkPrivate(5, name, storage.afkMsg)
        delay(5000)
    end
end)
UI.TextEdit(storage.afkMsg or "manda mensaje mas tarde, ando afk", function(widget, newText) -- campo de texto pra alterar a mensagem que vai ser a resposta (mude somente o texto)
storage.afkMsg = newText
end)


setDefaultTab("Main")
if player:getBlessings() == 0 then
    say("!bless")
    schedule(2000, function()
        if player:getBlessings() == 0 then
            error("!! Blessings not bought !!")
        end
    end)
end


setDefaultTab("Main")

UI.Label("Mana Training:")
if type(storage.manaTrain) ~= "table" then
  storage.manaTrain = {on=false, title="MP%", text="utevo lux", min=90, max=100}
end

local manatrainmacro = macro(500, function()
  if TargetBot and TargetBot.isActive() then return end -- pause when attacking
  local mana = math.min(100, math.floor(100 * (player:getMana() / player:getMaxMana())))
  if storage.manaTrain.max >= mana and mana >= storage.manaTrain.min then
    say(storage.manaTrain.text)
  end
end)
manatrainmacro.setOn(storage.manaTrain.on)

UI.DualScrollPanel(storage.manaTrain, function(widget, newParams) 
  storage.manaTrain = newParams
  manatrainmacro.setOn(storage.manaTrain.on)
end)


--SIN TABLA

containers = getContainers()
if #containers < 1 and containers[0] == nil then
  bpItem = getBack()
  if bpItem ~= nil then
    g_game.open(bpItem)
  end
end

warning = function() 
    --Made By MaDGENius
    --This will remove lots of others warning messages too, be warned xD
    return  
end



--ICONOS


local fields = {2122, 2118, 2119, 105} -- field ID
local destroyField = 3148 -- item que destruye

local apaga -- Variable para almacenar el icono creado

apaga = macro(500, function()
    local tileArroundMe = getNearTiles(pos())
    for _, tile in ipairs(tileArroundMe) do
        if table.find(fields, tile:getTopUseThing():getId()) then
            return useWith(destroyField, tile:getTopUseThing())
        end
    end
end)

apaga = addIcon("apaga", {item = 3148, text = "Apagar"}, apaga)

apaga:breakAnchors() -- Rompe las restricciones de posición actuales del icono
apaga:move(92,154)  -- Mueve el icono a la posición (92, 25)


local fields = {3590, 2983, 2984, 2981, 2433, 3035, 3031, 3504, 3503, 2471, 2473, 2472, 2469, 2524, 3492} -- field ID
local destroyField = 3197 -- item que destruye

local Trap -- Variable para almacenar el icono creado

Trap = macro(500, function()
    local tileArroundMe = getNearTiles(pos())
    for _, tile in ipairs(tileArroundMe) do
        if table.find(fields, tile:getTopUseThing():getId()) then
            return useWith(destroyField, tile:getTopUseThing())
        end
    end
end)

Trap = addIcon("Trap", {item = 3197, text = "Destruir"}, Trap)

Trap:breakAnchors() -- Rompe las restricciones de posición actuales del icono
Trap:move(92,197)  -- Mueve el icono a la posición (92, 25)



local fields = {2130} -- field ID
local destroyField = 3308 -- item que destruye

local Chet -- Variable para almacenar el icono creado

Chet = macro(500, function()
    local tileArroundMe = getNearTiles(pos())
    for _, tile in ipairs(tileArroundMe) do
        if table.find(fields, tile:getTopUseThing():getId()) then
            return useWith(destroyField, tile:getTopUseThing())
        end
    end
end)

Chet = addIcon("Chet", {item = 3308, text = "Machete"}, Chet)

Chet:breakAnchors() -- Rompe las restricciones de posición actuales del icono
Chet:move(92, 240)  -- Mueve el icono a la posición (92, 25)



local key = nil -- Sin hotkey
local mwallId = 3180 -- Mwall ID
local squaresThreshold = 1 -- Cantidad de sqm a tacar MW frente del personaje

local MwIcon -- Variable para almacenar el icono creado

MwIcon = macro(100, function()
    local target = g_game.getAttackingCreature()
    if target then
        local targetPos = target:getPosition()
        local targetDir = target:getDirection()
        local mwallTile
        if targetDir == 0 then -- north
            targetPos.y = targetPos.y - squaresThreshold
            mwallTile = g_map.getTile(targetPos)
            useWith(mwallId, mwallTile:getTopUseThing())
        elseif targetDir == 1 then -- east
            targetPos.x = targetPos.x + squaresThreshold
            mwallTile = g_map.getTile(targetPos)
            useWith(mwallId, mwallTile:getTopUseThing())
        elseif targetDir == 2 then -- south
            targetPos.y = targetPos.y + squaresThreshold
            mwallTile = g_map.getTile(targetPos)
            useWith(mwallId, mwallTile:getTopUseThing())
        elseif targetDir == 3 then -- west
            targetPos.x = targetPos.x - squaresThreshold
            mwallTile = g_map.getTile(targetPos)
            useWith(mwallId, mwallTile:getTopUseThing())
        end
    end
end)

MwIcon = addIcon("Mw", {item = 3180, hotkey = key, text = "Mwall FT"}, MwIcon)

MwIcon:breakAnchors() -- Rompe las restricciones de posición actuales del icono
MwIcon:move(92,111)  -- Mueve el icono a la posición (92, 25)




local cIcon = addIcon("cI", {text="Cave\nBot", switchable=false, moveable=true}, function()
    if CaveBot.isOff() then 
        CaveBot.setOn()
    else 
        CaveBot.setOff()
    end
end)
cIcon:setSize({height=30, width=50})
cIcon.text:setFont('verdana-11px-rounded')
cIcon:breakAnchors() -- Rompe las restricciones de posición actuales del icono
cIcon:move(400, 60) -- Mueve el icono a la posición (100, 100)

local tIcon = addIcon("tI", {text="Target\nBot", switchable=false, moveable=true}, function()
    if TargetBot.isOff() then 
        TargetBot.setOn()
    else 
        TargetBot.setOff()
    end
end)
tIcon:setSize({height=30, width=50})
tIcon.text:setFont('verdana-11px-rounded')
tIcon:breakAnchors() -- Rompe las restricciones de posición actuales del icono
tIcon:move(320, 60) -- Mueve el icono a la posición (100, 100)

macro(50, function()
    if CaveBot.isOn() then
        cIcon.text:setColoredText({"Cave Bot\n","white","ON","green"})
    else
        cIcon.text:setColoredText({"Cave Bot\n","white","OFF","red"})
    end
    if TargetBot.isOn() then
        tIcon.text:setColoredText({"Target Bot\n","white","ON","green"})
    else
        tIcon.text:setColoredText({"Target Bot\n","white","OFF","red"})
    end
end)



local countHP -- Variable para almacenar el icono creado

countHP = addIcon("MP", {text="", item = 23374}, function(widget, isOn)
    local id = 23374
    local contar = macro(1000, function() 
        local countItem = itemAmount(id)
        widget.text:setText(countItem.."\n")
        widget.text:setColor("yellow")
    end)
    contar:setOn()
end)

countHP:breakAnchors() -- Rompe las restricciones de posición actuales del icono
countHP:move(265, 45) -- Mueve el icono a la posición (100, 100)



local countHP -- Variable para almacenar el icono creado

countHP = addIcon("MP", {text="", item = 23373}, function(widget, isOn)
    local id = 23373
    local contar = macro(1000, function() 
        local countItem = itemAmount(id)
        widget.text:setText(countItem.."\n")
        widget.text:setColor("yellow")
    end)
    contar:setOn()
end)

countHP:breakAnchors() -- Rompe las restricciones de posición actuales del icono
countHP:move(365, 45) -- Mueve el icono a la posición (100, 100)



local amuletID = 3081
local item
amuleto = macro(200, function()
if hppercent() <= 50 and not getNeck() then
item = findItem(amuletID) 
g_game.move(item, {x=65535, y=SlotNeck, z=0}, 1)
elseif hppercent() >= 70 and getNeck() then
item = getNeck()
for _,container in pairs(getContainers()) do
g_game.move(item, container:getSlotPosition(), 1)
return
end
end
end)

amuleto = addIcon("amuleto", { item =3081, text = "50%"}, amuleto)
amuleto:breakAnchors()
amuleto:move(134,240)



--TABLA DE WAR


local SpellsTab = addTab("War") -- Agregar una nueva pestaña llamada "Spells"
local lblInfo = UI.Label("(((INMORTAL)))")
lblInfo:setColor("#f15976")  -- Azul pastel en formato hexadecimal
SpellsTab:addChild(lblInfo) -- Agregar la etiqueta a la pestaña "Spells"

--[[
  1. Start the script with your normal ring on 
  2. make sure the backpack with e-rings
     are always open
]]
-- By Mad Genius
setDefaultTab("war")

function theinmortal()
    local panelName = "theinmortal"
    local UI = setupUI([[
Panel
  height: 173
  margin-top: 2

  Label
    id: label1
    text:by: MadGenius
    anchors.top: parent.top
    anchors.left: parent.left
    margin-left: 50
    color: #f15976
    text-align: center

  Label
    id: labelSSA
    text: SSA when <= 50%:
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: label1.bottom
    margin-top: 5
    margin-left: 1
    color: #f8acba
    text-align: center

  HorizontalScrollBar
    id: scrollSSA
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: labelSSA.bottom
    margin-left: 5
    margin-right: 5
    margin-top: 5
    minimum: 1
    maximum: 100
    step: 1

  Label
    id: labelMR
    text: MIGHT RING when <= 50%:
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: scrollSSA.bottom
    color: #f8acba
    margin-top: 5
    text-align: center

  HorizontalScrollBar
    id: scrollMR
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: labelMR.bottom
    margin-left: 5
    margin-right: 5
    margin-top: 5
    minimum: 1
    maximum: 100
    step: 1

  Label
    id: labelUtamo
    text: Utamo Ring when <= 50%:
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: scrollMR.bottom
    color: #f8acba
    margin-top: 5
    text-align: center

  HorizontalScrollBar
    id: scrollUtamo
    anchors.left: parent.left
    anchors.right: parent.right
    anchors.top: labelUtamo.bottom
    margin-left: 5
    margin-right: 5
    margin-top: 5
    minimum: 1
    maximum: 100
    step: 1

  BotSwitch
    id: switchUtamo
    anchors.top: scrollUtamo.top
    anchors.right: parent.right
    anchors.left: parent.left
    margin-top: 20
    text-align: center
    text: Anillo Utamo

  BotSwitch
    id: switch
    anchors.bottom: parent.bottom
    anchors.right: parent.right
    anchors.left: parent.left
    text-align: center
    width: 130
    height: 25
    !text: tr('Inmortal')



]])
    if not storage[panelName] then
        storage[panelName] = {
            ssaValue = 70,
            mrValue = 70,
            uRingValue = 30,
            btnInmortal = false,
            btnAnilloU = false
        }
    end

    UI.switch:setOn(storage[panelName].btnInmortal)
    UI.switch.onClick = function(widget)
        storage[panelName].btnInmortal = not storage[panelName].btnInmortal
        widget:setOn(storage[panelName].btnInmortal)
    end

    UI.switchUtamo:setOn(storage[panelName].btnAnilloU)
    UI.switchUtamo.onClick = function(widget)
        storage[panelName].btnAnilloU = not storage[panelName].btnAnilloU
        widget:setOn(storage[panelName].btnAnilloU)
    end

    UI.labelSSA:setText("SSA <= " .. storage[panelName].ssaValue .. "%")

    UI.scrollSSA:setValue(storage[panelName].ssaValue)
    UI.scrollSSA.onValueChange = function(scroll, value)
        storage[panelName].ssaValue = value
        UI.labelSSA:setText("SSA <= " .. value .. "%")
    end

    UI.labelMR:setText("MIGHT RING <= " .. storage[panelName].mrValue .. "%")
    UI.scrollMR:setValue(storage[panelName].mrValue)
    UI.scrollMR.onValueChange = function(scroll, value)
        storage[panelName].mrValue = value
        UI.labelMR:setText("MIGHT RING <= " .. value .. "%")
    end

    UI.labelUtamo:setText("UTAMO RING <= " .. storage[panelName].uRingValue .. "%")
    UI.scrollUtamo:setValue(storage[panelName].uRingValue)
    UI.scrollUtamo.onValueChange = function(scroll, value)
        storage[panelName].uRingValue = value
        UI.labelUtamo:setText("UTAMO RING <= " .. value .. "%")
    end

    local amulet = 3081
    local ring = 3048
    local ering = 3051
    local aering = 3088
    local lastAction = now

    function desequipar(value)
        local item = Item.create(value)
        g_game.equipItem(item)
    end

    -- basic ring check
    function defaultRingFind()
        if storage[panelName].ringEnabled then
            if getFinger() and (getFinger():getId() ~= ring and getFinger():getId() ~= getActiveItemId(ring)) then
                defaultRing = getInactiveItemId(getFinger():getId())
            else
                defaultRing = false
            end
        end
    end

    -- basic amulet check
    function defaultAmmyFind()
        if storage[panelName].ammyEnabled then
            if getNeck() and (getNeck():getId() ~= amulet and getNeck():getId() ~= getActiveItemId(amulet)) then
                defaultAmmy = getInactiveItemId(getNeck():getId())
            else
                defaultAmmy = false
            end
        end
    end

    macro(10, function()
        if now - lastAction < math.max(math.max(g_game.getPing() * 2, 150), 300) then
            return
        end
        if not storage[panelName].btnInmortal then
            return
        end

        local eringEquipped = getFinger() and (getFinger():getId() == aering)
        local ringEquipped = getFinger() and
                                 (getFinger():getId() == ring or getFinger():getId() == getActiveItemId(ring))
        local ssaEquipped = getNeck() and (getNeck():getId() == amulet or getNeck():getId() == getActiveItemId(amulet))

        if eringEquipped then
            -- SSA --
            if not ssaEquipped and storage[panelName].btnAnilloU then
                defaultAmmyFind()
                if hppercent() <= storage[panelName].ssaValue then
                    g_game.equipItemId(amulet)
                    lastAction = now
                    return
                end
            elseif ssaEquipped and hppercent() > storage[panelName].ssaValue then
                desequipar(amulet)
                lastAction = now
                return
            end
        end

        -- SI NO TIENE ACTIVADO EL BOTON DE E RING
        if not storage[panelName].btnAnilloU then
            if hasManaShield() then
                -- MIGHT RING --
                if not ringEquipped then
                    defaultRingFind()
                    if manapercent() <= storage[panelName].mrValue then
                        g_game.equipItemId(ring)
                        lastAction = now
                        return
                    end
                elseif ringEquipped then
                    if manapercent() > storage[panelName].mrValue then
                        desequipar(ring)
                        lastAction = now
                        return
                    end
                end

            elseif not hasManaShield() then
                -- MIGHT RING --
                if not ringEquipped then
                    defaultRingFind()
                    if hppercent() <= storage[panelName].mrValue then
                        g_game.equipItemId(ring)
                        lastAction = now
                        return
                    end
                elseif ringEquipped then
                    if hppercent() > storage[panelName].mrValue then
                        desequipar(ring)
                        lastAction = now
                        return
                    end
                end
            end

        end
        if storage[panelName].btnAnilloU then
            -- MIGHT RING --
            if not ringEquipped then
                defaultRingFind()
                if hppercent() <= storage[panelName].mrValue and hppercent() > storage[panelName].uRingValue then
                    g_game.equipItemId(ring)
                    lastAction = now
                    return
                elseif hppercent() <= storage[panelName].uRingValue or
                    (getFinger() == nil and hppercent() <= storage[panelName].uRingValue) then
                    g_game.equipItemId(ering)
                    lastAction = now
                    return
                elseif eringEquipped and hppercent() > storage[panelName].uRingValue then
                    desequipar(aering)
                    lastAction = now
                    return
                end
            elseif ringEquipped then
                if hppercent() > storage[panelName].mrValue then
                    desequipar(ring)
                    lastAction = now
                    return
                end
                if hppercent() <= storage[panelName].uRingValue then
                    g_game.equipItemId(ering)
                    lastAction = now
                    return
                end
            end
        end

        if storage[panelName].btnAnilloU and storage[panelName].mrValue <= storage[panelName].uRingValue then
            warn("NO PUEDES PONER MAS ALTO EL PORCENTAJE DEL ENERGY RING QUE EL DE MIGHT RING")
            storage[panelName].uRingValue = storage[panelName].mrValue - 10
            UI.scrollUtamo:setValue(storage[panelName].uRingValue)
            UI.labelUtamo:setText("UTAMO RING <= " .. storage[panelName].uRingValue .. "%")
            return
        end
        if hasManaShield() then
            -- SSA --
            if not ssaEquipped then
                defaultAmmyFind()
                if manapercent() <= storage[panelName].ssaValue then
                    g_game.equipItemId(amulet)
                    lastAction = now
                    return
                end
            elseif ssaEquipped and manapercent() > storage[panelName].ssaValue then
                desequipar(amulet)
                lastAction = now
                return
            end
        else
            -- SSA --
            if not ssaEquipped then
                defaultAmmyFind()
                if hppercent() <= storage[panelName].ssaValue then
                    g_game.equipItemId(amulet)
                    lastAction = now
                    return
                end
            elseif ssaEquipped and hppercent() > storage[panelName].ssaValue then
                desequipar(amulet)
                lastAction = now
                return
            end
        end

        
    end)
end -- END FUNCTION theinmortal

if g_game.getClientVersion() >= 1000 then
    theinmortal()
    
end


local SpellsTab = addTab("War") -- Agregar una nueva pestaña llamada "Spells"
local lblInfo = UI.Label("COMBO LIDER")
lblInfo:setColor("#87CEEB")  -- Azul pastel en formato hexadecimal
SpellsTab:addChild(lblInfo) -- Agregar la etiqueta a la pestaña "Spells"


local comboTab = addTab("War")

local comboOptions = {
  leader = storage.gpSpellComboLeader or "Mad Genius",
  trigger = storage.gpSpellComboTrigger or "xd",
  spell = storage.gpSpellComboSpell or "exevo gran mas vis",
}

addLabel("leaderLabel", "Player Lider: ", comboTab)
addTextEdit("leaderValue", comboOptions.leader, function(widget, text)
  comboOptions.leader = text
  storage.gpSpellComboLeader = text
end, comboTab)

addLabel("triggerLabel", "Palabra Clave: ", comboTab)
addTextEdit("triggerValue", comboOptions.trigger, function(widget, text)
  comboOptions.trigger = text
  storage.gpSpellComboTrigger = text
end, comboTab)

addLabel("spellLabel", "Spell Combo:", comboTab)
addTextEdit("spellValue", comboOptions.spell, function(widget, text)
  comboOptions.spell = text
  storage.gpSpellComboSpell = text
end, comboTab)

onTalk(function(name, level, mode, text, channelId, pos)
  if not comboOptions.trigger then
    return
  end

  if name and name:lower() == comboOptions.leader:lower() then
    if text == comboOptions.trigger then
      say(comboOptions.spell)
    end
  end
end)

setDefaultTab("War")
lblInfo = UI.Label("Summon Familiar (editar)")
lblInfo:setColor("white")

local textBox = UI.TextEdit("utevo gran res sac")
local cooldown = 5000 -- segundos

Pet = macro(100, function()
    local spell = textBox:getText()
    if canCast(spell) then
        cast(spell, cooldown * 60)
        delay(cooldown * 60)
    end
end)

Pet = addIcon("PET", {item = 9606, text = "Pet"}, Pet)

Pet:breakAnchors() -- Rompe las restricciones de posición actuales del icono
Pet:move(500, 25) -- Mueve el icono a la posición (100, 100)


local ringID = 3048
local item
ring = macro(200, function()
if hppercent() <= 45 and not getFinger() then
item = findItem(ringID)
g_game.move(item, {x=65535, y=SlotFinger, z=0}, 1)
elseif hppercent() >= 80 and getFinger() then
item = getFinger()
for _,container in pairs(getContainers()) do
g_game.move(item, container:getSlotPosition(), 1)
return
end
end
end)

ring = addIcon("ring", { item =3048, text = "45%"}, ring)
ring:breakAnchors()
ring:move(134,197)


function moveItem(item, destination)
  return g_game.move(item, destination:getSlotPosition(destination:getItemsCount()), item:getCount())
end


setDefaultTab("War")

shEnabled = false
gpPushDelay = 300 -- safe value: 300ms

local toolstab = addTab("Tools")
local switch = addSwitch("gpPushEnabled", "Stack Items", function(widget)
    widget:setOn(not widget:isOn())
    gpPushEnabled = widget:isOn()
end, tab)

macro(gpPushDelay, function ()
    if gpPushEnabled then
        push(0, -1, 0)
        push(0, 1, 0)
        push(-1, -1, 0)
        push(-1, 0, 0)
        push(-1, 1, 0)
        push(1, -1, 0)
        push(1, 0, 0)
        push(1, 1, 0)
    end
end)

function push(x, y, z)
    local position = player:getPosition()
    position.x = position.x + x
    position.y = position.y + y
  
    local tile = g_map.getTile(position)
    local thing = tile:getTopThing()
    if thing and thing:isItem() then
      g_game.move(thing, player:getPosition(), thing:getCount())
    end
end


setDefaultTab("War")
local colocaring = 55; 
local tiraring = 75; 
macro(1, "Energy ring 55%", function()
  if (hppercent() <= colocaring) then
    local ring1 = findItem(3051) 
    if (ring1) then
        g_game.move(ring1, {x=65535, y=SlotFinger, z=0}, 1);
    end
  elseif (hppercent() >= tiraring) then
     local ring2 = findItem(39182) 
     if (ring2) then
        g_game.move(ring2, {x=65535, y=SlotFinger, z=0}, 1);
    end 
  end
end)


setDefaultTab("War")
local utamoHp = 65 --- below this % hp will cast utamo vita
local exuraHp = 90 --- above this % hp will cast exana vita (
local safeMana = 20
macro(100, "Utamo 65% - Exana 90%", function()
    if hppercent() <= utamoHp and not hasManaShield() and manapercent() > safeMana then
        say("utamo vita")
    elseif hasManaShield() and (hppercent() >= exuraHp or manapercent() < safeMana) then
        say("exana vita")
    end
end)

